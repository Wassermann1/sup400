; ============================================
; КОНСТАНТЫ ДЛЯ VT03 (500-in-1 МНОГОИГРОВОЙ КАРТРИДЖ)
; ============================================

; ============================================
; 1. НАСТРОЙКИ ROM
; ============================================
PRG_BANKS = 2              ; 32KB PRG-ROM (на самом деле больше, но для заголовка)
CHR_BANKS = 1              ; 8KB CHR-ROM
MIRRORING = %0001          ; Vertical mirroring
MAPPER_NUMBER = 0          ; NROM mapper (реально VT03 с банкованием)
PRG_RAM_SIZE = 0           ; Нет PRG RAM

; ============================================
; 2. СТАНДАРТНЫЕ РЕГИСТРЫ NES
; ============================================
PPU_CTRL   = $2000         ; IO_SystemControl
PPU_MASK   = $2001         ; IO_VideoControl  
PPU_STATUS = $2002         ; IO_PPUStatus
OAM_ADDR   = $2003         ; IO_SpriteStartAddress
OAM_DATA   = $2004         ; IO_SpriteDataPort
PPU_SCROLL = $2005         ; IO_ScreenPosition
PPU_ADDR   = $2006         ; IO_VRAMAddress
PPU_DATA   = $2007         ; IO_VRAMDataPort

; ============================================
; 3. РЕГИСТРЫ БАНКОВ VROM (ГРАФИКА VT03)
; ============================================
VROM_BANK0 = $2012         ; Банк графики 0
VROM_BANK1 = $2013         ; Банк графики 1  
VROM_BANK2 = $2014         ; Банк графики 2
VROM_BANK3 = $2015         ; Банк графики 3
VROM_BANK4 = $2016         ; Банк графики 4
VROM_BANK5 = $2017         ; Банк графики 5
VROM_BANKM = $2018         ; Master bank control (дополнительный)
VROM_BANKM2 = $201A        ; Второй мастер банк (из кода запуска)

; ============================================
; 4. РАСШИРЕННЫЕ РЕГИСТРЫ VT03
; ============================================
VMODE_CTRL = $2010         ; IO_VModeControl - режимы видео
LCD_CTRL   = $2011         ; IO_LCDControl - управление LCD

; ============================================
; 5. РЕГИСТРЫ АУДИО (APU/PSG)
; ============================================
APU_PULSE1 = $4000         ; IO_PSGControlAddress
APU_PULSE2 = $4004
APU_TRI    = $4008
APU_NOISE  = $400C
APU_DMC    = $4010         ; IO_PSGDPCMControl
DMC_VOL    = $4011         ; IO_PSGDPCMVolume
DMC_ADDR   = $4012         ; IO_PSGDPCMAddress
DMC_LEN    = $4013         ; IO_PSGDPCMLength
OAM_DMA    = $4014         ; IO_DMASourceH / IO_SpriteDMASource
APU_STATUS = $4015         ; IO_PSGIRQStatus
JOY1       = $4016         ; IO_StrobeControl (контроллер 1)
JOY2       = $4017         ; IO_Joystick2Control (контроллер 2)

; ============================================
; 6. ДОПОЛНИТЕЛЬНЫЕ РЕГИСТРЫ VT03
; ============================================
PCM_DATA   = $4027         ; IO_PCMDataPort - дополнительный PCM звук
DMA_CTRL   = $4034         ; IO_DMAControl - управление DMA

; ============================================
; 7. РЕГИСТРЫ БАНКОВАНИЯ VT03 (ОСНОВНЫЕ)
; ============================================
ROM_HI_BANK   = $4100      ; IO_ROMHighBank - старшие биты банков PROM/VROM
PRG_BANK0     = $4107      ; IO_ProgramBank0 - банк программы 0 ($8000-$9FFF)
PRG_BANK1     = $4108      ; IO_ProgramBank1 - банк программы 1 ($A000-$BFFF)
PRG_BANK2     = $4109      ; IO_ProgramBank2 - банк программы 2 ($C000-$DFFF)
PRG_BANK3     = $410A      ; IO_ProgramBank3 - банк программы 3 ($E000-$FFFF)
DECODE_TYPE0  = $4105      ; Тип декодирования 0
DECODE_TYPE1  = $410B      ; Тип декодирования 1 (используется при запуске игр)
SCREEN_HV     = $4106      ; IO_ScreenHV - ориентация экрана

; ============================================
; 8. ТАЙМЕРЫ VT03
; ============================================
TIMER1      = $4101        ; Таймер 1
TIMER2      = $4102        ; Таймер 2  
TIMER_CLOSE = $4103        ; Отключение таймера
TIMER_OPEN  = $4104        ; Включение таймера

; ============================================
; 9. РЕГИСТРЫ ДОПОЛНИТЕЛЬНЫХ УСТРОЙСТВ
; ============================================
REG_4116    = $4116        ; Используется в проверке устройства
REG_4118    = $4118        ; Используется в проверке устройства
REG_412B    = $412B        ; Регистр команд устройства
REG_412C    = $412C        ; Регистр данных/статуса устройства

; ============================================
; 10. РЕГИСТРЫ ИЗ ОРИГИНАЛЬНОГО КОДА
; ============================================
REG_411C    = $411C        ; Используется в reset_handler
REG_412D    = $412D        ; Используется в начале reset
REG_4137    = $4137        ; Используется в начале reset
REG_4138    = $4138        ; Используется в reset и при запуске игр
REG_4139    = $4139        ; Используется в reset и при запуске игр

; Регистры устройства (из кода A000)
REG_4FF0 = $4FF0
REG_4FF1 = $4FF1
REG_4FF2 = $4FF2
REG_4FF3 = $4FF3
REG_4FF4 = $4FF4
REG_4FF5 = $4FF5
REG_4FF7 = $4FF7
REG_4FF8 = $4FF8
REG_4FFA = $4FFA

; Регистры чтения состояния
REG_4135 = $4135
REG_4136 = $4136

; ============================================
; 11. РЕГИСТРЫ МАППЕРА (MMC3 СОВМЕСТИМОСТЬ)
; ============================================
MAPPER_SELECT = $8000      ; Регистр выбора банка
MAPPER_DATA   = $8001      ; Регистр данных банка

; ============================================
; 12. СТРУКТУРА МНОГОИГРОВОГО МЕНЮ
; ============================================
GAMES_PER_PAGE = 8         ; 8 игр на странице
TOTAL_GAMES    = 500       ; Всего игр в картридже
TOTAL_PAGES    = 63        ; 500 / 8 = 62.5 → 63 страницы

; ============================================
; 13. ПЕРЕМЕННЫЕ МЕНЮ (ИЗ ОРИГИНАЛЬНОГО КОДА)
; ============================================
; Основные переменные навигации
MENU_PAGE      = $03EF     ; Текущая страница меню (0-62)
MENU_SLOT      = $03F0     ; Выбранный слот на странице (0-7)
MENU_FLAG      = $03F6     ; Флаг или счётчик (сбрасывается в sub_FCBF)

; Состояние контроллеров
CTRL1_STATE    = $03BD     ; Состояние контроллера 1 (после sub_D01E)
CTRL2_STATE    = $03BE     ; Состояние контроллера 2 (после sub_D01E)

; Переменные отображения меню
MENU_POS_X1    = $03FB     ; Координата X? (инициализируется $88)
MENU_POS_Y1    = $03FC     ; Координата Y? (инициализируется $1E)
MENU_TIMER     = $03B0     ; Таймер или счётчик (инициализируется $20)

; Буфер меню
MENU_BUFFER    = $0407     ; Буфер из 34 байт (заполняется $0E в sub_FCB2)
MENU_BUF_LEN   = $22       ; 34 байта

; ID игры (устанавливается при выборе)
GAME_ID        = $042A     ; ID выбранной игры (из таблицы)

; Флаг дополнительного устройства
DEVICE_STATUS  = $058C     ; Статус устройства (0=нет, 1=есть)

; Другие переменные
COUNTER_3CB    = $03CB     ; Счётчик/флаг (используется в reset)
BYTE_E000      = $E000     ; Переменная (используется в reset)

; ============================================
; 14. АДРЕСА ЗАПУСКА ИГР
; ============================================
LAUNCH_CODE_SRC = $FF14    ; Исходный код запуска в ROM (59 байт)
LAUNCH_CODE_DST = $0408    ; Копия кода запуска в RAM
LAUNCH_CODE_LEN = $3A      ; 59 байт ($3A = 58, но BCC значит <59)

; Векторы
NMI_HANDLER = $FFFA
VECTOR_RESET   = $FFFC     ; Вектор RESET (2 байта) - прыгает на игру
IRQ_HADLER = $FFFE

; ============================================
; 15. МАСКИ КНОПОК КОНТРОЛЛЕРА
; ============================================
; Порядок битов в $03BD/$03BE после sub_D01E:
;   Бит 7: A
;   Бит 6: B
;   Бит 5: Select
;   Бит 4: Start
;   Бит 3: Up
;   Бит 2: Down
;   Бит 1: Left
;   Бит 0: Right

BUTTON_A      = %10000000
BUTTON_B      = %01000000
BUTTON_SELECT = %00100000   ; ВАЖНО: В коде проверяется бит 6 ($40), 
BUTTON_START  = %00010000   ; но в sub_D01E порядок мог измениться!
BUTTON_UP     = %00001000
BUTTON_DOWN   = %00000100
BUTTON_LEFT   = %00000010
BUTTON_RIGHT  = %00000001

; ============================================
; 16. ВРЕМЕННЫЕ ПЕРЕМЕННЫЕ
; ============================================
TEMP_401      = $0401      ; Временная переменная (используется в sub_D772/sub_D7A1)

; ============================================
; 17. ДИНАМИЧЕСКИЕ ВЕКТОРЫ
; ============================================
VECTOR_A000   = $A000      ; Динамический вектор (2 байта)
                            ; sub_EFD9 делает JSR $A000
                            ; При запуске игры сбрасывается в 0

; ============================================
; 18. ТАБЛИЦЫ ДИСПЕТЧЕРИЗАЦИИ
; ============================================
DISPATCH_TABLE = $FDD6     ; Основная таблица указателей на таблицы страниц
                            ; 75 записей × 2 байта = 150 байт

; ============================================
; 19. ГРАНИЦЫ ЭКРАНА (ДЛЯ ИГР)
; ============================================
MIN_X = 8
MAX_X = 248
MIN_Y = 8
MAX_Y = 232

; ============================================
; 20. ТАЙЛЫ (ПРИМЕР, ДЛЯ ИГР)
; ============================================
TILE_PLAYER = $00
TILE_ENEMY  = $01
TILE_BULLET = $02

; ============================================
; 21. ЗВУКОВЫЕ КАНАЛЫ
; ============================================
SOUND_CH1 = $4000
SOUND_CH2 = $4004
SOUND_CH3 = $4008
SOUND_CH4 = $400C


; ============================================
; ПЕРЕМЕННЫЕ ИЗ КОДА $A000
; ============================================

; Основные переменные навигации меню
MENU_STATE_110 = $0110     ; Основное состояние меню
MENU_STATE_111 = $0111     ; Дополнительное состояние/подсостояние
MENU_STATE_112 = $0112     ; Ещё один уровень состояния
MENU_ACTION_116 = $0116    ; Код действия (устанавливается диспетчером)
MENU_MODE_114 = $0114      ; Режим обработки (0-4)

; Указатели на данные меню
MENU_DATA_PTR_L = $00F8    ; Младший байт указателя на данные
MENU_DATA_PTR_H = $00F9    ; Старший байт указателя на данные

; Регистр завершения
MENU_COMPLETE_FLAG = $4FF6 ; Флаг завершения ($81 когда готово)

; Адреса функций в коде $A000
FUNC_A7AF = $A7AF
FUNC_A9C4 = $A9C4
FUNC_A96A = $A96A
FUNC_A965 = $A965
FUNC_A6F6 = $A6F6
FUNC_A725 = $A725
FUNC_A758 = $A758
FUNC_A782 = $A782
FUNC_A7E2 = $A7E2
FUNC_A806 = $A806
FUNC_A82A = $A82A