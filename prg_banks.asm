; ============================================
; МОДУЛЬ: sub_FD43 для VT03
; Назначение: Настройка банков программы на VT03
; Устанавливает банки PRG_BANK0 и PRG_BANK1
; ============================================

.ifndef SUB_FD43_INC
SUB_FD43_INC = 1

.include "constants.inc"
.include "variables.inc"

.segment "CODE"

; ============================================
; PROC: setup_prg_banks
; sub_FD43
; Устанавливает банки программы на VT03
; $3C -> PRG_BANK0 (банк 0x3C в адресное пространство)
; $3D -> PRG_BANK1 (банк 0x3D в адресное пространство)
; Затем вызывает инициализационные подпрограммы
; ============================================
.proc setup_prg_banks
    ; Установка банков программы на VT03
    ; Банк 0x3C помещается в окно программы (вероятно, $8000-$9FFF)
    lda #$3C
    sta PRG_BANK0       ; $4107 - банк программы 0
    
    ; Банк 0x3D помещается в следующее окно (вероятно, $A000-$BFFF)
    lda #$3D
    sta PRG_BANK1       ; $4108 - банк программы 1
    
    ; Инициализация каких-то систем с параметром 0
    ; (возможно, очистка памяти, настройка переменных)
    lda #0
    jsr sub_D772       ; Базовая инициализация
    
    ; Дополнительная настройка с параметром 4
    ; (возможно, настройка графики или игрового состояния)
    lda #4
    jsr sub_D7A1       ; Настройка игрового режима
    
    rts
.endproc

; Подключаем функции маппера
.include "mapper.asm"

; ============================================
; 
; Аналог sub_D772
;
; ============================================
.proc sub_D772
    STA     $401
    TXA
    PHA
    LDX     #2
    STX     $8000
    LDA     $401
    STA     $8001
    INX
    STX     $8000
    CLC
    ADC     #1
    STA     $8001
    INX
    STX     $8000
    ADC     #1
    STA     $8001
    INX
    STX     $8000
    ADC     #1
    STA     $8001
    PLA
    TAX
    RTS
.endproc

; ============================================
;
; Аналог sub_D7A1
;
; ============================================
.proc sub_D7A1
    STA     TEMP_401
    TXA
    PHA
    LDX     #0
    STX     $8000
    LDA     $401
    STA     $8001
    INX
    STX     $8000
    CLC
    ADC     #2
    STA     $8001
    PLA
    TAX
    RTS
.endproc

.endif ; SUB_FD43_INC